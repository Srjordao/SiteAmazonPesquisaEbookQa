name: Testes Regressivos Ebook QA Iniciante

on:
  push:
    branches:
      - main  # Altere para a branch em que deseja executar os testes
  pull_request:
    branches:
      - main

# Agendamento para executar nos horários específicos
  schedule:
   - cron: "0 9,11,15,18 * * 1-5"  # Executar às 9h, 11h, 15h e 18h UTC de segunda a sexta-feira

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout do código
        uses: actions/checkout@v2

      - name: Configurar ambiente Python
        uses: actions/setup-python@v2
        with:
          python-version: 3.x  # Altere para a versão do Python que você está usando

      - name: Instalar dependências
        run: |
          python -m pip install --upgrade pip
          pip install selenium
          pip install webdriver_manager
          pip install pytesseract
          pip install opencv-python

      - name: Instalar o Google Chrome
        run: |
          wget https://mirror.cs.uchicago.edu/google-chrome/pool/main/g/google-chrome-stable/google-chrome-stable_125.0.6422.76-1_amd64.deb
          sudo dpkg -i google-chrome-stable_125.0.6422.76-1_amd64.deb
          sudo apt-get install -f
          rm google-chrome-stable_125.0.6422.76-1_amd64.deb

      - name: Obter a versão do Google Chrome
        id: get-chrome-version
        run: |
          CHROME_VERSION=$(google-chrome --version | grep -oP '(?<=Google Chrome )[^ ]+')
          echo "CHROME_VERSION=${CHROME_VERSION}" >> $GITHUB_ENV
          echo "Versão do Google Chrome: $CHROME_VERSION"

      - name: Instalar o ChromeDriver
        run: |
          CHROME_VERSION=${{ env.CHROME_VERSION }}
          CHROME_DRIVER_VERSION=$(curl -s "https://googlechromelabs.github.io/chrome-for-testing/known-good-versions-with-downloads.json" | jq -r --arg CHROME_VERSION "$CHROME_VERSION" '.versions[] | select(.version==$CHROME_VERSION) | .downloads.chromedriver[] | select(.platform=="linux64").url')
          wget $CHROME_DRIVER_VERSION -O chromedriver_linux64.zip
          unzip chromedriver_linux64.zip
          chmod +x chromedriver
          sudo mv chromedriver /usr/local/bin/
          rm chromedriver_linux64.zip
          
      - name: Executar testes
        run: python tests/test_amazon.py
